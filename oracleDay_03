-----day03

/* 테아블을 생성하면서 제약조건 부여1 */
CREATE TABLE MEMBERS2(
     MID NVARCHAR2(20) CONSTRAINT UK_MEM2_MID UNIQUE ,  --아이디
     MPW NVARCHAR2(20),  --비밀번호
     MNAME NVARCHAR2(5), --이름
     MEMAIL NVARCHAR2(20)--이메일
);
/* 테이블을 생성하면서 제약조건 부여2 */
CREATE TABLE MEMBERS3(
     MID3 NVARCHAR2(20),    --아이디
     MPW3 NVARCHAR2(20),    --비밀번호
     MNAME3 NVARCHAR2(5),   --이름
     MEMAIL3 NVARCHAR2(20), --이메일
     CONSTRAINT UK_MEM3_MID UNIQUE(MID3)
);
/* UNIQUE : 테이블의 특정한 컬럼 부여, 중복되는 값이 입력되지 않도록 방지 */
INSERT INTO MEMBERS3(MID3, MPW3, MNAME3, MEMAIL3)
VALUES('JGH', '1111', '전관호', 'QWE123@ICIA.CO.KR' ); 
INSERT INTO MEMBERS3(MID3, MPW3, MNAME3, MEMAIL3)
VALUES('JGH', '1234', '회원02', '회원02@ICIA.CO.KR' ); 

--MID 컬럼에 NULL값 입력
INSERT INTO MEMBERS3(MPW3, MNAME3, MEMAIL3)
VALUES('1234', '회원03', '회원03@ICIA.CO.KR' );
INSERT INTO MEMBERS3(MID3, MPW3, MNAME3, MEMAIL3)
VALUES(NULL, '1234', '회원04', '회원04@ICIA.CO.KR' ); 
SELECT * FROM MEMBERS3;

/* NOT NULL : 지정된 컬럼에 NULL값울 허용하지 않는다.(옵션-안쓰면 NULL값을 허용) */
CREATE TABLE MEMBERS(
     MID NVARCHAR2(20) CONSTRAINT NN_MEM_MID NOT NULL, --아이디
     MPW NVARCHAR2(20),     --비밀번호
     MNAME NVARCHAR2(5),    --이름
     MEMAIL NVARCHAR2(20),  --이메일
     CONSTRAINT UK_MEM_MID UNIQUE(MID)
);
INSERT INTO MEMBERS(MID, MPW, MNAME, MEMAIL)
VALUES(NULL, '1234', '회원01', '회원01@ICIA.CO.KR' ); --ORA-01400: NULL을 ("JGH_DBA"."MEMBERS"."MID") 안에 삽입할 수 없습니다

DROP TABLE MEMBERS;
CREATE TABLE MEMBERS(
     MID NVARCHAR2(20),     --아이디
     MPW NVARCHAR2(20),     --비밀번호
     MNAME NVARCHAR2(5),    --이름
     MEMAIL NVARCHAR2(20),  --이메일
     CONSTRAINT UK_MEM_MID UNIQUE(MID)
);
ALTER TABLE MEMBERS 
MODIFY MID NOT NULL;
DESC MEMBERS;
--UNIQUE 제약조건삭제
ALTER TABLE MEMBERS DROP CONSTRAINT UK_MEM_MID;
--NOT NULL=>NULL
ALTER TABLE MEMBERS MODIFY MID NULL;

/* 제약조건 
 - UNIQUE : 테이블의 특정한 컬럼 부여, 중복되는 값이 입력 되지 않도록 방지
 - NOT NULL : 트정 컬럼에 NULL값이 입력 되지 않도록 방지
 - PRIMARY KEY : UNIQUE + NOT NULL (테이블에 한번만 부여할 수 있음)
                 테이블에서 레코드를 구분 지을 수 있는 유일한 컬럼에 부여
*/
DROP TABLE MEMBERS;
CREATE TABLE MEMBERS(
     MID NVARCHAR2(20),     --아이디
     MPW NVARCHAR2(20),     --비밀번호
     MNAME NVARCHAR2(5),    --이름
     MEMAIL NVARCHAR2(20)  --이메일
);
-- MID 컬럼에 PRIMARY KEY 부여
ALTER TABLE MEMBERS ADD CONSTRAINT PK_MEM_MID PRIMARY KEY(MID);
INSERT INTO MEMBERS(MID, MPW, MNAME, MEMAIL)
VALUES('JGH', '1111', '전관호', 'QWE123@ICIA.CO.KR');
INSERT INTO MEMBERS(MID, MPW, MNAME, MEMAIL) -- UNIQUE 확인
VALUES('JGH', '1234', '회원01', '회원01@ICIA.CO.KR'); --오류: ORA-00001: 무결성 제약 조건(JGH_DBA.PK_MEM_MID)에 위배됩니다

INSERT INTO MEMBERS(MID, MPW, MNAME, MEMAIL) -- NOT NULL 확인
VALUES(NULL, '1234', '회원02', '회원02@ICIA.CO.KR'); -- ORA-01400: NULL을 ("JGH_DBA"."MEMBERS"."MID") 안에 삽입할 수 없습니다
--이메일 컬럼에 UNIQUE 제약 조건 부여
ALTER TABLE MEMBERS ADD CONSTRAINT UK_MEM_MEMAIL UNIQUE(MEMAIL);
INSERT INTO MEMBERS(MID, MPW, MNAME, MEMAIL)
VALUES('ID01', '1234', '회원01', NULL);
INSERT INTO MEMBERS(MID, MPW, MNAME, MEMAIL)
VALUES('ID02', '1234', '회원02', NULL); -- UNIQUE는 NULL값이 들어감

-- MNAME에 PRIMARY KEY 부여
ALTER TABLE MEMBERS ADD CONSTRAINT PK_MEM_MNAME PRIMARY KEY(MNAME); -- ORA-02260: 테이블에는 하나의 기본 키만 가질 수 있습니다.
ALTER TABLE MEMBERS ADD CONSTRAINT UK_MEM_MNAME UNIQUE(MNAME);
SELECT * FROM MEMBERS;

/* DEFAULT : 특정하 컬럼에 값이 입력되지 않을 경우 기본으로 입력되는 값을 설정 */
DROP TABLE MEMBERS;
CREATE TABLE MEMBERS(
     MID NVARCHAR2(20),     --아이디
     MPW NVARCHAR2(20),     --비밀번호
     MNAME NVARCHAR2(20) DEFAULT '이름없음',   --이름
     MAGE NUMBER            --나이
);
INSERT INTO MEMBERS(MID, MPW, MAGE)
VALUES('ID01', '1234', 10);
INSERT INTO MEMBERS(MID, MAGE)
VALUES('ID01', 10);
SELECT * FROM MEMBERS;
INSERT INTO MEMBERS(MID, MPW, MNAME, MAGE)
VALUES('ID02', '1234', DEFAULT, 20);

/* 나이 컬럼에 기본값 1 설정 */
ALTER TABLE MEMBERS MODIFY MAGE DEFAULT 1;

/* CHECK : 특정한 컬럼에 입력할 수 있는 값에 대한 조건 부여 */
DROP TABLE MEMBERS;
CREATE TABLE MEMBERS(
     MID NVARCHAR2(20),     --아이디
     MPW NVARCHAR2(20),     --비밀번호
     MNAME NVARCHAR2(20),   --이름
     MAGE NUMBER,            --나이
     CONSTRAINT CK_MEM_MAGE CHECK(MAGE > 10) 
);
INSERT INTO MEMBERS(MAGE)
VALUES(30); -- 1 행 이(가) 삽입되었습니다.
SELECT * FROM MEMBERS;
INSERT INTO MEMBERS(MAGE)
VALUES(5); -- ORA-02290: 체크 제약조건(JGH_DBA.CK_MEM_MAGE)이 위배되었습니다

/* 제약조건 
 - PRIMARY KEY
 - UNIQUE
 - NOT NULL
 - FOREIGE KEY
 - CHECK 
 - DEFAULT
*/

-- FOREIGE KEY
DROP TABLE MEMBERS;
CREATE TABLE MEMBERS(
     MID NVARCHAR2(20),    --아이디
     MPW NVARCHAR2(20)     --비밀번호
);
-- MID 컬럼에 PRIMARY KEY 부여
ALTER TABLE MEMBERS
ADD CONSTRAINT PK_MEM_MID PRIMARY KEY(MID);

INSERT INTO MEMBERS(MID, MPW)
VALUES('JGH', '1111'); -- 회원 정보 입력
INSERT INTO MEMBERS(MID, MPW)
VALUES('ABC', '1234'); 
SELECT * FROM MEMBERS;

DROP TABLE LOGINCHECK;
CREATE TABLE LOGINCHECK( -- 회원의 로그인 시간
    MID NVARCHAR2(20),   -- 회원 아이디 - MEMBERS 테이블의 MID컬럼의 값
    LOGINTIME DATE       -- 로그인 시간
);
-- LOGINCHECK테이블에 MID 컬럼에 FOREIGN KEY 지정
ALTER TABLE LOGINCHECK
ADD CONSTRAINT FK_LOG_MID FOREIGN KEY( MID )
REFERENCES MEMBERS(MID);

-- FOREIGE KEY : MEMBERS테이블에 있는 데이터만 LOGINCHECK테이블에 쓸 수 있음
INSERT INTO LOGINCHECK(MID, LOGINTIME)
VALUES('ICIA', SYSDATE); -- ORA-02291: 무결성 제약조건(JGH_DBA.FK_LOG_MID)이 위배되었습니다- 부모 키가 없습니다

INSERT INTO LOGINCHECK(MID, LOGINTIME)
VALUES('JGH', SYSDATE); -- 입력가능
INSERT INTO LOGINCHECK(MID, LOGINTIME)
VALUES('ABC', SYSDATE); -- 입력가능

SELECT * FROM LOGINCHECK;
